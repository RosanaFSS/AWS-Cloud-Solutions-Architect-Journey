<h3>AWS Skill Builder &nbsp;&nbsp; > &nbsp;&nbsp; Build Practical Skills &nbsp;&nbsp; > &nbsp;&nbsp;  Security Monitoring</h3>
<p>December 3, 2024<br></p>

![image](https://github.com/user-attachments/assets/33e98c97-5be7-40a2-8101-82d8f1773a84)

<p>Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure.<br>
It´s key part of my AWS hands-on journey.<br>
Let´s get started!!</p>

<br>
<h3><code>Level</code>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intermediate<br><br>
<code>Duration</code>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;approximately 45 minutes<br><br>
<code>Intended Audience</code>:&nbsp;&nbsp;Security Engineers</h3>

<br>
<h3><code>Objectives</code>:</h3>
In this tutorial, we will:
<ul style="list-style-type:square">
    <li>Configure an <code>Amazon Linux 2 instance</code> to send log files to <code>Amazon CloudWatch</code>.</li>
    <li>Create <code>Amazon CloudWatch alarms</code> and <code>notifications</code> to <code>monitor for failed login attempts</code>.</li>
    <li>Create <code>Amazon CloudWatch alarms</code> to <code>monitor network traffic</code> through a NAT gateway.</li>
</ul>

<br>
<h3><code>Prerequisites</code>:</h3>
We recommend that attendees of this course have the following prerequisites:
<ul style="list-style-type:square">
    <li>Familiar with basic navigation of the AWS Management Console.</li>
    <li>Comfortable running commands in a Linux command line interface (CLI).</li>
    <li>Create <code>Amazon CloudWatch alarms</code> to <code>monitor network traffic</code> through a NAT gateway.</li>
</ul>

<br>
<h3><code>Outline</code>:</h3>
<ul style="list-style-type:square">
    <li>Task 1: Send local logs from an EC2 instance to Cloudwatch.</li>
    <li>Task 2: Create a CloudWatch alarm and notification.</li>
    <li>Task 3: Monitor a NAT gateway.</li>
</ul>

<br>
<br>

<h2>Security Monitoring</h2>
<p>As a security engineer at AnyCompany, <em><strong>you are responsible for monitoring the company network and Amazon Elastic Compute Cloud (Amazon EC2) instances for abnormal activity</strong></em>.<br>

In this lab, you configure an Amazon Linux 2 instance to send log files to Amazon CloudWatch. You then create Amazon CloudWatch alarms and notifications to alert you to a specified number of login failures on your EC2 instances. Finally, you create a CloudWatch alarm and notification to monitor outgoing traffic through a NAT gateway.</p>

![image](https://github.com/user-attachments/assets/1b71d3f1-d162-41b8-ade7-03a09905d6b8)

The following list details the major resources in the diagram:
<ul style="list-style-type:square">
    <li>A <code>VPC</code> with one <code>public subnet</code> and two private subnets in one Availability Zone, and one <code>public subnet</code>code> in a second Availability Zone.</li>
    <li>A <code>Network Load Balancer</code> with two nodes, one in each public subnet.</li>
    <li>An <code>EC2 instance</code> acting as a web server in the first private subnet.</li>
    <li>An <code>EC2 instance</code> acting as a database server in the second subnet.</li>
    <li>Two <code>security groups</code>, one for each instance based on its purpose.</li>
</ul>

<p>The network traffic flows from an external user, through an internet gateway to one of the two Network Load Balancer nodes, to the web server. If the URL of the WordPress blog site running on the web server is requested, traffic flows to the database server as well.</p>


<br>
<h2>1. Send local logs from an EC2 instance to Cloudwatch.</h2>
<p>In this task, you install the Amazon CloudWatch agent on an Amazon Linux 2 EC2 instance. The instance serves as the database server for your customer facing blog site and contains sensitive information, so you would like to easily monitor any abnormalities.</p>

<h3>1.1. Install the CloudWatch agent.</h3>
<p>In the navigation pane at the left of the page, choose Instances.<br>
Select Database Server and then, at the upper-right of the page, choose Connect</p>

![image](https://github.com/user-attachments/assets/78605ea0-e2bb-477d-8c4c-53645052dee8)

<p>On the Connect to instance page, choose the Session Manager tab, and then choose Connect</p>

![image](https://github.com/user-attachments/assets/e9c22083-6257-4694-83a1-a86d4aadb95b)

<br>

![image](https://github.com/user-attachments/assets/03fa19ab-967e-404e-987f-bb6bd12c48ee)

<p>Run the following command to install the CloudWatch agent package:</p>

<pre><code>sudo yum install -y amazon-cloudwatch-agent</code></pre>

![image](https://github.com/user-attachments/assets/bc03ab7f-01a3-4080-92bd-9ba97cb531c5)

<p> Run the following command to start the CloudWatch agent configuration wizard:</p>

<pre><code>sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-config-wizard</code></pre>

<p>The wizards opens a menu. I chose [ 1 ] = Linux.</p>

![image](https://github.com/user-attachments/assets/f78c9c3e-430a-4c71-85d1-351d3e936a74)

<p>For Are you using EC2 or On-Premises hosts?, enter 1 for EC2.<br>
For Which user are you planning to run the agent?, enter 2 for root.<br>
For Do you want to turn on StatsD daemon?, enter 2 for no.<br>
For Do you want to monitor metrics from CollectD?, enter 2 for no.<br>
For Do you want to monitor any host metrics?, enter 2 for no.<br>
For Do you have any existing CloudWatch Log Agent configuration file to import for migration?, enter 2 for no.<br>
For Do you want to monitor any log files?, enter 1 for yes.</p>

![image](https://github.com/user-attachments/assets/9c862d64-e902-4db4-93a4-ccb2147c45fc)


<p>For Log file path:, enter /var/log/secure.<br>
For Log group name:, enter database_server_security_logs.<br>
For Log group class: press Enter to keep the default value of 1.<br>
For Log stream name:, press Enter to keep the default value of {instance_id}.<br>
For Log Group Retention in days, press Enter to keep the default value of 1.<br>
For Do you want to specify any additional log files to monitor?, enter 2 for no.<br>








<h3>1.2. Generate authentication failures in the security logs.</h3>
<h3>1.3. Verify the log files are sent to CloudWatch.</h3>

<br>
<h2>2. Create a CloudWatch alarm and notification.</h2>
<h3>2.1. Create a metric filter.</h3>
<h3>2.2. Create a CloudWatch alarm from a metric filter.</h3>
<h3>2.3. Verify the alarm is activated.</h3>

<br>
<h2>3. Monitor a NAT gateway.</h2>
<h3>3.1. Create a CloudWatch alarm to monitor outgoing network traffic through the NAT gateway.</h3>
<h3>2.2. Generate enough outgoing traffic to activate the alarm.</h3>

<br>
<h2>Conclusion</h2>
<p>Congratulations! You now have successfully:</p>
<ul style="list-style-type:square">
    <li>Configured an Amazon Linux 2 instance to send log files to Amazon CloudWatch.</li>
    <li>Created Amazon CloudWatch alarms and notifications to monitor for failed login attempts</li>
    <li>Created Amazon CloudWatch alarms to monitor network traffic through a NAT gateway.</li>
</ul>

<br>
<h2>End Lab</h2>


