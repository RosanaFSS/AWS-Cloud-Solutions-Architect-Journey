<h3>AWS Skill Builder &nbsp;&nbsp; > &nbsp;&nbsp; Build Practical Skills &nbsp;&nbsp; > &nbsp;&nbsp;  Security Monitoring</h3>
<p>December 3, 2024<br></p>

![image](https://github.com/user-attachments/assets/33e98c97-5be7-40a2-8101-82d8f1773a84)

<p>Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure.<br>
It´s key part of my AWS hands-on journey.<br>
Let´s get started!!</p>

<br>
<h3><code>Level</code>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intermediate<br>
<code>Duration</code>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;approximately 45 minutes<br>
<code>Intended Audience</code>:&nbsp;&nbsp;Security Engineers</h3>
<h3><code>Objectives</code>:</h3>
In this tutorial, we will:
<ul style="list-style-type:square">
    <li>Configure an <code>Amazon Linux 2 instance</code> to send log files to <code>Amazon CloudWatch</code>.</li>
    <li>Create <code>Amazon CloudWatch alarms</code> and <code>notifications</code> to <code>monitor for failed login attempts</code>.</li>
    <li>Create <code>Amazon CloudWatch alarms</code> to <code>monitor network traffic</code> through a NAT gateway.</li>
</ul>
<h3><code>Prerequisites</code>:</h3>
We recommend that attendees of this course have the following prerequisites:
<ul style="list-style-type:square">
    <li>Familiar with basic navigation of the AWS Management Console.</li>
    <li>Comfortable running commands in a Linux command line interface (CLI).</li>
    <li>Create <code>Amazon CloudWatch alarms</code> to <code>monitor network traffic</code> through a NAT gateway.</li>
</ul>
<h3><code>Outline</code>:</h3>
<ul style="list-style-type:square">
    <li>Task 1: Send local logs from an EC2 instance to Cloudwatch.</li>
    <li>Task 2: Create a CloudWatch alarm and notification.</li>
    <li>Task 3: Monitor a NAT gateway.</li>
</ul>

<h2>Security Monitoring</h2>
<p>As a security engineer at AnyCompany, <em><strong>you are responsible for monitoring the company network and Amazon Elastic Compute Cloud (Amazon EC2) instances for abnormal activity</strong></em>.<br>

In this lab, you configure an Amazon Linux 2 instance to send log files to Amazon CloudWatch. You then create Amazon CloudWatch alarms and notifications to alert you to a specified number of login failures on your EC2 instances. Finally, you create a CloudWatch alarm and notification to monitor outgoing traffic through a NAT gateway.</p>

<div style="display: flex; justify-content: center; align-items: center;">
    <img src="https://github.com/user-attachments/assets/1b71d3f1-d162-41b8-ade7-03a09905d6b8" width="400x"/>
</div>
<br>

The following list details the major resources in the diagram:
<ul style="list-style-type:square">
    <li>A <code>VPC</code> with one <code>public subnet</code> and two private subnets in one Availability Zone, and one <code>public subnet</code>code> in a second Availability Zone.</li>
    <li>A <code>Network Load Balancer</code> with two nodes, one in each public subnet.</li>
    <li>An <code>EC2 instance</code> acting as a web server in the first private subnet.</li>
    <li>An <code>EC2 instance</code> acting as a database server in the second subnet.</li>
    <li>Two <code>security groups</code>, one for each instance based on its purpose.</li>
</ul>

<p>The network traffic flows from an external user, through an internet gateway to one of the two Network Load Balancer nodes, to the web server. If the URL of the WordPress blog site running on the web server is requested, traffic flows to the database server as well.</p>


<br>
<h2>1. Send local logs from an EC2 instance to Cloudwatch.</h2>
<p>In this task, you install the Amazon CloudWatch agent on an Amazon Linux 2 EC2 instance. The instance serves as the database server for your customer facing blog site and contains sensitive information, so you would like to easily monitor any abnormalities.</p>

<h3>1.1. Install the CloudWatch agent.</h3>
<p>In the navigation pane at the left of the page, choose Instances.<br>
Select Database Server and then, at the upper-right of the page, choose Connect</p>

![image](https://github.com/user-attachments/assets/78605ea0-e2bb-477d-8c4c-53645052dee8)

<p>On the Connect to instance page, choose the Session Manager tab, and then choose Connect</p>

![image](https://github.com/user-attachments/assets/e9c22083-6257-4694-83a1-a86d4aadb95b)

<br>

![image](https://github.com/user-attachments/assets/03fa19ab-967e-404e-987f-bb6bd12c48ee)

<p>Run the following command to install the CloudWatch agent package:</p>

<pre><code>sudo yum install -y amazon-cloudwatch-agent</code></pre>

<p> Run the following command to start the CloudWatch agent configuration wizard:</p>

<pre><code>sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-config-wizard</code></pre>

<p>The wizards opens a menu. I chose [ 1 ] = Linux.<br>
For Are you using EC2 or On-Premises hosts?, enter 1 for EC2.<br>
For Which user are you planning to run the agent?, enter 2 for root.<br>
For Do you want to turn on StatsD daemon?, enter 2 for no.<br>
For Do you want to monitor metrics from CollectD?, enter 2 for no.<br>
For Do you want to monitor any host metrics?, enter 2 for no.<br>
For Do you have any existing CloudWatch Log Agent configuration file to import for migration?, enter 2 for no.<br>
For Do you want to monitor any log files?, enter 1 for yes.<br>
For Log file path:, enter <code>/var/log/secure</code>.<br>
For Log group name:, enter database_server_security_logs.<br>
For Log group class: press Enter to keep the default value of 1.<br>
For Log stream name:, press Enter to keep the default value of {instance_id}.<br>
For Log Group Retention in days, press Enter to keep the default value of 1.<br>
For Do you want to specify any additional log files to monitor?, enter 2 for no.<br>
For Do you want the CloudWatch agent to also retrieve X-ray traces?, enter 2 for no.<br>
For <code><em></em>Do you want to store the config in the SSM parameter store?</em></code>, enter 2 for no.</p>


<br>

<pre><code>
cd $HOME; pwd
sh-4.2$ cd $HOME; pwd
/home/ec2-user
sh-4.2$ sudo yum install -y amazon-cloudwatch-agent
Loaded plugins: extras_suggestions, langpacks, priorities, update-motd
amzn2-core                                                                                                                                                                               | 3.6 kB  00:00:00
Package amazon-cloudwatch-agent-1.300044.0-1.amzn2.x86_64 already installed and latest version
Nothing to do
sh-4.2$ sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-config-wizard
================================================================
= Welcome to the Amazon CloudWatch Agent Configuration Manager =
=                                                              =
= CloudWatch Agent allows you to collect metrics and logs from =
= your host and send them to CloudWatch. Additional CloudWatch =
= charges may apply.                                           =
================================================================
On which OS are you planning to use the agent?
1. linux
2. windows
3. darwin
default choice: [1]:
1
Trying to fetch the default region based on ec2 metadata...
I! imds retry client will retry 1 timesAre you using EC2 or On-Premises hosts?
1. EC2
2. On-Premises
default choice: [1]:
1
Which user are you planning to run the agent?
1. cwagent
2. root
3. others
default choice: [1]:
2
Do you want to turn on StatsD daemon?
1. yes
2. no
default choice: [1]:
2
Do you want to monitor metrics from CollectD? WARNING: CollectD must be installed or the Agent will fail to start
1. yes
2. no
default choice: [1]:
2
Do you want to monitor any host metrics? e.g. CPU, memory, etc.
1. yes
2. no
default choice: [1]:
2
Do you have any existing CloudWatch Log Agent (http://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/AgentReference.html) configuration file to import for migration?
1. yes
2. no
default choice: [2]:
2
Do you want to monitor any log files?
1. yes
2. no
default choice: [1]:
1
Log file path:
/var/log/source
Log group name:
default choice: [source]
database_server_security_logs
Log group class:
1. STANDARD
2. INFREQUENT_ACCESS
default choice: [1]:
1
Log stream name:
default choice: [{instance_id}]

Log Group Retention in days
1. -1
2. 1
3. 3
4. 5
5. 7
6. 14
7. 30
8. 60
9. 90
10. 120
11. 150
12. 180
13. 365
14. 400
15. 545
16. 731
17. 1096
18. 1827
19. 2192
20. 2557
21. 2922
22. 3288
23. 3653
default choice: [1]:

Do you want to specify any additional log files to monitor?
1. yes
2. no
default choice: [1]:
2
Do you want the CloudWatch agent to also retrieve X-ray traces?
1. yes
2. no
default choice: [1]:
2
Existing config JSON identified and copied to:  /opt/aws/amazon-cloudwatch-agent/etc/backup-configs
Saved config file to /opt/aws/amazon-cloudwatch-agent/bin/config.json successfully.
Current config as follows:
{
        "agent": {
                "run_as_user": "root"
        },
        "logs": {
                "logs_collected": {
                        "files": {
                                "collect_list": [
                                        {
                                                "file_path": "/var/log/source",
                                                "log_group_class": "STANDARD",
                                                "log_group_name": "database_server_security_logs",
                                                "log_stream_name": "{instance_id}",
                                                "retention_in_days": -1
                                        }
                                ]
                        }
                }
        }
}
Please check the above content of the config.
The config file is also located at /opt/aws/amazon-cloudwatch-agent/bin/config.json.
Edit it manually if needed.
Do you want to store the config in the SSM parameter store?
1. yes
2. no
default choice: [1]:
2
Program exits now.
sh-4.2$</code></pre>

<br>


<p>Run the following command to start the CloudWatch agent service:</p>

<pre><code>sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -s -c file:/opt/aws/amazon-cloudwatch-agent/bin/config.json</code></pre>

<p>I got the following output.</p>

<pre><code>h-4.2$ sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -s -c file:/opt/aws/amazon-cloudwatch-agent/bin/config.json
****** processing amazon-cloudwatch-agent ******
I! Trying to detect region from ec2 D! [EC2] Found active network interface I! imds retry client will retry 1 timesSuccessfully fetched the config and saved in /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.d/file_config.json.tmp
Start configuration validation...
2024/12/03 21:40:27 Reading json config file path: /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.d/file_config.json.tmp ...
2024/12/03 21:40:27 I! Valid Json input schema.
2024/12/03 21:40:27 Configuration validation first phase succeeded
I! Detecting run_as_user...
I! Trying to detect region from ec2
D! [EC2] Found active network interface
I! imds retry client will retry 1 times
/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent -schematest -config /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.toml
Configuration validation second phase succeeded
Configuration validation succeeded
amazon-cloudwatch-agent has already been stopped
Created symlink from /etc/systemd/system/multi-user.target.wants/amazon-cloudwatch-agent.service to /etc/systemd/system/amazon-cloudwatch-agent.service.
sh-4.2$</code></pre>

<br>

<p>Run the following command to verify the status of the CloudWatch agent service:</p>

<pre><code>sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -m ec2 -a status</code></pre>

<p>I got the following output.</p>

<pre><code>sh-4.2$ sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -m ec2 -a status
{
  "status": "running",
  "starttime": "2024-12-03T21:40:28+0000",
  "configstatus": "configured",
  "version": "1.300044.0"
}
sh-4.2$</code></pre>

<br>
<h3>1.2. Generate authentication failures in the security logs.</h3>
<p> Run the following command to attempt to log in as dbdev:</p>

<pre><code>su dbdev</code></pre>

<p>When prompted for a password, be creative and try to guess what the password might be! Remember, you are trying to generate authentication failures, so failed logins are what you want.<br>
Repeat the previous two steps three more times to generate a total of 4 failed login attempts.</p>

<p>I got this output.</p>

<pre><code>h-4.2$ su dbdev
Password:
su: Authentication failure
sh-4.2$ su dbdev
Password:
su: Authentication failure
sh-4.2$ su dbdev
Password:
su: Authentication failure
sh-4.2$ su dbdev
Password:
su: Authentication failure
</code></pre>

<br>
<h3>1.3. Verify the log files are sent to CloudWatch.</h3>

<p>Return to your web browser tab with the EC2 management console.<br>

At the top of the page, in the unified search bar, search for and choose CloudWatch.<br>

In the navigation pane at the left of the page, under Logs, choose Log groups.<br>

On the Log groups page, select the link for the database_server_security_logs log group.<br>

If the database_server_security_logs is not listed, wait 1 minute, and then choose the  refresh button at the upper-right of the page.<br>

On the database_server_security_logs page, choose the Log streams tab.<br>
In the Log streams section, notice there is one log stream that is named with the EC2 instance ID of the database server instance.<br>

Choose the link for the log stream name to view the security logs from the database server instance.</p>

![image](https://github.com/user-attachments/assets/b57dba2b-323a-4701-a43a-700084476b4f)

<br>
<h2>2. Create a CloudWatch alarm and notification.</h2>
<p>Now that you are sending the security logs from the database server to CloudWatch, you can create CloudWatch metrics and alarms to monitor the logs for any abnormal behavior.<br>

In this task, you create a CloudWatch metric filter to locate authentication failure event messages in the logs from the database server. You then create a CloudWatch alarm and notification to email you any time there are too many login failures within a 5 minute window.</p>

<br>

<h3>2.1. Create a metric filter.</h3>
<p>In the navigation breadcrumbs at the top of the page, select the database_server_security_logs link.<br>

On the database_server_security_logs page, choose the Metric filters tab.<br>

At the upper-right of the Metric filters section, choose Create metric filter.<br>

On the Define pattern page:<br>

- In the Create filter pattern section, for Filter pattern, enter "authentication failure".<br>
- In the Test pattern section, for Select log data to test, select the EC2 instance ID for the database server.<br>
---- The EC2 instance ID should match the value of DatabaseServerId listed to the left of these instructions.<br>
Choose Test pattern.</p>

![image](https://github.com/user-attachments/assets/ab35c861-6219-4799-869a-7e529fe148a5)

<br>

![image](https://github.com/user-attachments/assets/52489c81-069d-4897-a50a-78400fb6e95a)

<br>

![image](https://github.com/user-attachments/assets/0ae66bfb-cb33-4948-9c47-5779fbfdbd80)

<br>

![image](https://github.com/user-attachments/assets/f4300b97-ac07-453f-9e19-b28de3f8141a)

<br>

<p>At the bottom of the page, choose Next.<br>

On the Assign metric page:<br>

- In the Create filter name section, for Filter name, enter database server authentication failures.<br>
- In the Metric details section, for Metric namespace, enter authentication failures and verify the Create new option is toggled on.<br>
- For Metric name, enter database server authentication failures.<br>
- For Metric value, enter 1.<br>
- For Default value, enter 0.<br><br>
At the bottom of the page, choose Next.<br>

On the Review and create page, choose <code>Create metric filter</code>.<br>

You should notice a  Metric filter “database server authentication failures” has been created. message at the top of the page.</p>

![image](https://github.com/user-attachments/assets/5e70badc-27ac-4490-bbac-5e3a67b615fb)

<br>

![image](https://github.com/user-attachments/assets/f0f419a3-fded-4a60-b989-4779eb3eb98b)

<br>

![image](https://github.com/user-attachments/assets/e7909234-0f5e-47e3-b283-81f9fc5cf692)

<br>

![image](https://github.com/user-attachments/assets/1b193743-c1d4-407c-a6ab-11b38ce29d5b)

<br>

![image](https://github.com/user-attachments/assets/0e4f3a18-11c4-438b-ba71-b50ddc92339a)

<br>



<h3>2.2. Create a CloudWatch alarm from a metric filter.</h3>
<p>On the database_server_security_logs page, on the Metric filters tab, you should see a card for database server authentication failures filter.<br>

Select the checkbox  at the upper-right corner of the database server authentication failures card.<br>

Choose Create alarm.<br>
A new web browser tab opens to the Specify metrics and conditions page.</p>

<p>On the Specify metrics and conditions page, in the Metric section, verify the following defaults:</p>
- For Metric name, enter database server authentication failures.<br>
- For Statistic, select Sum.<br>
- For Period, select 5 minutes.<br>

<br>
<p>In the Conditions section:</p>
- For Threshold type, select  Static.<br>
- For Whenever database server authentication failures is…, select  Greater.<br>
- For than…, enter 2.<br>

<br>

<p>Expand the Additional configuration section, and then:</p>
- For Missing data treatment, select Treat missing data as good (not breaching threshold).<br>

<p>At the bottom of the page, choose Next.</p>

<p>On the Configure actions page, in the Notification section:</p>
- For Alarm state trigger, select  In alarm.<br>
- For Send a notification to the following SNS topic, select  Create new topic.<br>
- For Create a new topic…, enter CloudWatch_alarm_notifications.<br>
- For Email endpoints that will receive the notification…, enter your email address.<br>

<p>Choose Create topic.

At the bottom of the page, choose Next.<br>

On the Add name and description page:</p>
- For Alarm name, enter database server authentication failures alarm.<br>
For Alarm description, enter Alarms and notifies for more than 2 authentication failures over a span of 5 minutes.<br>

<p>Choose Next.<br>

At the bottom of the Preview and create page, choose Create alarm.<br>

You should notice two banners at the top of the page:</p>

![image](https://github.com/user-attachments/assets/70413b1f-e588-461a-b2ef-f96aecc0ae94)

<p>You must confirm your email address before Amazon SNS can send notification messages to you.</p>

<p>Check your email for a message from AWS Notifications with a subject line of AWS Notification - Subscription Confirmation.</p>

<p>The message should look similar to this:<br>

You have chosen to subscribe to the topic: arn:aws:sns:us-west-2[Redacted]:CloudWatch_alarm_notifications<br>

To confirm this subscription, click or visit the link below (If this was in error no action is necessary): Confirm subscription<br>

Please do not reply directly to this email. If you wish to remove yourself from receiving all future SNS subscription confirmation requests please send an email to sns-opt-out</p>

<p>Select the Confirm subscription link.<br>
 A new web browser tab should open to a Subscription confirmed! page.<br>

Close your web browser tab with the Subscription confirmed! page.<br>

In the Some subscriptions are pending confirmation banner at top of the page, choose View SNS Subscriptions.<br>

On the Subscriptions page, verify that the status for the CloudWatch_alarm_notifications topic is  Confirmed.<br>

Close your web browser tab with the Subscriptions page.</p>

![image](https://github.com/user-attachments/assets/60990231-fa4a-44ea-bb7a-bbb907b53eed)

<br>

![image](https://github.com/user-attachments/assets/325e9d1f-fc3d-4185-8923-2e12d9e04600)


<br>


![image](https://github.com/user-attachments/assets/91cad7fd-a071-42bb-9bdc-ab6c665c245b)

<br>

![image](https://github.com/user-attachments/assets/e81135fe-b721-410b-b817-0923365b9c1f)

<br>

![image](https://github.com/user-attachments/assets/14d2b5fa-d0ab-45b5-855c-d4b7421184af)

<br>

![image](https://github.com/user-attachments/assets/1afa25b3-5669-4473-8b20-b7659b281f64)

<br>

![image](https://github.com/user-attachments/assets/363c9c48-f2ad-4a8f-8ca4-b346adf1c496)

<br>

![image](https://github.com/user-attachments/assets/d6741a3c-df39-4a0f-a8a8-77dc06326ec4)

<br>

![image](https://github.com/user-attachments/assets/fd932c82-838d-4560-bd1e-760538c08557)

<br>

![image](https://github.com/user-attachments/assets/687c46b3-228b-4823-b0f9-ea3de9139785)

<br>

![image](https://github.com/user-attachments/assets/9c4f0ac1-ded0-4c09-8944-32edb705b5e2)


<br>

![image](https://github.com/user-attachments/assets/e6b57ff5-4462-46ba-af16-e1660ef621f2)



<h3>2.3. Verify the alarm is activated.</h3>
<p>In the CloudWatch navigation pane at the left of the page, under Alarms, choose All alarms.<br>

Select the database server authentication failures alarm link to view the alarm details.<br>

Scroll down the page to the Details tab.<br>

 Is the alarm State currently In alarm or OK? What do you think has caused the current state of the alarm?<br>

When you configured the alarm, you set it to alert for two or more authentication failures in a five minute time span. If that situation occurs, the alarm state changes to In alarm until there is another time span of five or more minutes where there are no authentication failures, at which point the alarm state changes back to OK.<br>

If the alarm state is  OK, return to the Database Server console session and attempt to log in as dbdev again.<br>
Refer to Task 1.2 for the commands to attempt to log in as dbdev, if necessary.<br>

Return to your web browser tab with the database server authentication failures alarm and refresh the page.<br>
 It can take approximately 2 minutes for the alarm state to change to In alarm.<br>

The alarm status should now be  In alarm and you should receive an email notification regarding the state change.<br>

 Congratulations! You have successfully created a CloudWatch alarm and notification to monitor authentication failures on an EC2 instance.</p>

<br>

![image](https://github.com/user-attachments/assets/e3af6374-a891-47a6-95fa-6d62949b3f21)

<br>
<h2>3. Monitor a NAT gateway.</h2>
<p>In addition to monitoring authentication failures, you want to monitor for abnormal outgoing network traffic.<br>

In this task, you create a CloudWatch alarm to monitor metrics related to outgoing traffic through a NAT gateway.</p>

<br>
<h3>3.1. Create a CloudWatch alarm to monitor outgoing network traffic through the NAT gateway.</h3>
<p>In the CloudWatch navigation pane at the left of the page, under Alarms, choose All alarms.<br>

At the upper-right of the Alarms page, choose Create alarm.<br>

On the Specify metric and conditions page, choose Select metric.<br>

In the Metrics section, under AWS namespaces, choose NATGateway.<br>

Choose Nat Gateway Metrics.<br>

In the search bar at the top of the Metrics section, search for BytesOutToDestination.<br>

The list of metrics should now be filtered to only show the BytesOutToDestination metric name.<br>

Select the metric with a NatGatewayId that matches the NatGatewayId value listed to the left of these instructions.<br>

At the bottom of the page, choose Select metric.<br>

On the Specify metrics and conditions page, in the Metric section:<br>

- For Metric name, enter BytesOutToDestination.<br>
- For NatGatewayId, verify it matches the NatGatewayId value listed to the left of these instructions.<br>
- For Statistic, select Sum.<br>
- For Period, select 15 minutes.<br><br>
In the Conditions section:<br>
- For Threshold type, select  Static.<br>
- For Whenever BytesOutToDestination is…, select  Greater.<br>
- For than…, enter 2000000.<br><br>
At the bottom of the page, choose Next.<br>

On the Configure actions page, in the Notification section:<br>

- For Alarm state trigger, select  In alarm.<br>
- For Send a notification to the following SNS topic, select  Select an existing SNS topic.<br>
- For Send a notification to…, select CloudWatch_alarm_notifications.<br><br>
At the bottom of the page, choose Next.<br>

On the Add name and description page:<br>

- For Alarm name, enter NAT gateway outgoing traffic alarm.<br>
- For Alarm description, enter Alarms and notifies for more than 2 MB of outgoing network traffic over 15 minutes.<br><br>
Choose Next.<br>

At the bottom of the Preview and create page, choose Create alarm.<br>

You should notice a  <code>Successfully created alarm NAT gateway outgoing traffic alarm</code>. message at the top of the page.</p>

![image](https://github.com/user-attachments/assets/92b6ba31-16cf-4030-8e74-4e3e3c044cc3)

<br>

![image](https://github.com/user-attachments/assets/cf7b3c6f-fefb-40df-956b-ff10ae897e64)

<br>

![image](https://github.com/user-attachments/assets/13bb8164-6a76-487a-8ef1-4c6218e0721f)

<br>

![image](https://github.com/user-attachments/assets/f34607ef-dd32-46e3-83d4-5c8190289743)

<br>

![image](https://github.com/user-attachments/assets/cdf18205-adb1-451c-abbf-8077f59f8039)

<br>
<h3>3.2. Generate enough outgoing traffic to activate the alarm.</h3>
<p>Next, you upload data to an S3 bucket to generate enough outgoing traffic to trigger the alarm. A sample file named SampleData.zip was added to the Database Server instance during the lab environment build process. The file has a size of approximately 2.3 MB.</p>

<p>Return to your web browser tab with the console connection to the Database Server instance.</p>

<p>Run the following command to set an environment variable to hold the name of the S3 bucket:</p>

<pre><code>TestBucket=TEST_BUCKET</code></pre>

<p>Run the following command to upload the SampleData.zip file to an S3 bucket in the lab environment:</p>
- Replace the <code>TEST_BUCKET</code> placeholder value with the <code>TestBucket</code> value listed to the left of these instructions.<br>

<p>Run the following command to upload the <code>SampleData.zip</code> file to an S3 bucket in the lab environment</p>

<pre><code>aws s3 cp ~/SampleData.zip s3://$TestBucket/</code></pre>

<p>I got the following output.</p>

<pre><code>cd $HOME; pwd
sh-4.2$ cd $HOME; pwd
/home/ec2-user
sh-4.2$ TestBucket=lab-network-test-us-west-[Redacted]
sh-4.2$ aws s3 cp ~/SampleData.zip s3://$TestBucket/
upload: ./SampleData.zip to s3://lab-network-test-us-west-[Redacted]/SampleData.zip
sh-4.2$</code></pre>

<br>

<p>Return to your web browser tab with the CloudWatch console.<br>

If you are not on the Alarms page already, in the navigation pane at the left of the page, choose All alarms.<br>

Wait approximately 1-2 minutes and then refresh the page. You should notice that NAT gateway outgoing traffic alarm now has a status of  In alarm. You should also receive a notification email from AWS Notifications with the details of the alarm status change.</p>


![image](https://github.com/user-attachments/assets/27428713-605f-4efe-9433-62718104d228)

<br>

![image](https://github.com/user-attachments/assets/4da2e3ca-5cf3-453c-b48f-08e86450daa0)


<p>Congratulations! You have successfully created a CloudWatch alarm to monitor outgoing network traffic through a NAT gateway!</p>

<br>
<h2>Conclusion</h2>
<p>Congratulations! You now have successfully:</p>
<ul style="list-style-type:square">
    <li>Configured an Amazon Linux 2 instance to send log files to Amazon CloudWatch.</li>
    <li>Created Amazon CloudWatch alarms and notifications to monitor for failed login attempts</li>
    <li>Created Amazon CloudWatch alarms to monitor network traffic through a NAT gateway.</li>
</ul>

<br>
<h2>End Lab</h2>
<ul style="list-style-type:square">
    <li>Return to the AWS Management Console.</li>
    <li>At the upper-right corner of the page, choose AWSLabsUser, and then choose Sign out.</li>
    <li>Choose End Lab and then confirm that you want to end your lab.</li>
</ul>


